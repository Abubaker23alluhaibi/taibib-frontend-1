# โ ุญู ูุดุงูู ุงูููุงุนูุฏ ูุงูุฅุดุนุงุฑุงุช

## ๐จ **ุงููุดุงูู ุงูุชู ุชู ุญููุง:**

### **1. โ ุงูููุงุนูุฏ ุชุธูุฑ ูุน ุงูุณุงุจูุฉ ุจุฏูุงู ูู ุงูููู ููุท**
### **2. โ ุงูุฅุดุนุงุฑุงุช ูุง ุชุตู ููุฏูุชูุฑ ุนูุฏ ุญุฌุฒ ููุนุฏ**

---

## ๐ **ุชูุงุตูู ุงููุดุงูู:**

### **โ ุงููุดููุฉ 1: ุนุฑุถ ุงูููุงุนูุฏ**
- **ุงูููุงุนูุฏ ุชุธูุฑ ูุน ุงูุณุงุจูุฉ** ุจุฏูุงู ูู ุงูููู ููุท
- **ุงููุณุชุฎุฏู ูุฑูุฏ ุฑุคูุฉ ููุงุนูุฏ ุงูููู ููุท** ุนูุฏ ุนุฏู ุชูุนูู "ุนุฑุถ ุงูุณุงุจูุฉ"

### **โ ุงููุดููุฉ 2: ุฅุดุนุงุฑุงุช ุงูุฏูุชูุฑ**
- **ุงูุฅุดุนุงุฑุงุช ูุง ุชุตู ููุฏูุชูุฑ** ุนูุฏ ุญุฌุฒ ููุนุฏ ุฌุฏูุฏ
- **ุนุฏู ูุฌูุฏ ูุธุงู ุฅุดุนุงุฑุงุช** ูุนูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

---

## ๐๏ธ **ุงูุญููู ุงููุทุจูุฉ:**

### **โ ุงูุญู 1: ุฅุตูุงุญ ุนุฑุถ ููุงุนูุฏ ุงูููู ููุท**

#### **ุงูุชุญุฏูุซ ูู MyAppointments.js:**
```javascript
// ูุจู (ุฎุงุทุฆ)
const uniqueDisplayedAppointments = (() => {
  const allToDisplay = showPastAppointments 
    ? [...todayAppointments, ...upcomingAppointments, ...pastAppointments]
    : [...todayAppointments, ...upcomingAppointments];
  
  const uniqueMap = new Map();
  allToDisplay.forEach(appointment => {
    const key = `${appointment.doctorId}-${appointment.date}-${appointment.time}`;
    if (!uniqueMap.has(key)) {
      uniqueMap.set(key, appointment);
    }
  });
  
  return sortAppointments(Array.from(uniqueMap.values()));
})();

// ุจุนุฏ (ุตุญูุญ)
const uniqueDisplayedAppointments = (() => {
  // ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ูุฑูุฏ ุฑุคูุฉ ููุงุนูุฏ ุงูููู ููุท
  if (!showPastAppointments) {
    // ุนุฑุถ ููุงุนูุฏ ุงูููู ููุท
    const todayOnly = todayAppointments.filter(appointment => {
      const key = `${appointment.doctorId}-${appointment.date}-${appointment.time}`;
      return true; // ุนุฑุถ ุฌููุน ููุงุนูุฏ ุงูููู
    });
    
    console.log('๐ ููุงุนูุฏ ุงูููู ููุท:', todayOnly.length);
    return sortAppointments(todayOnly);
  }
  
  // ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ูุฑูุฏ ุฑุคูุฉ ุฌููุน ุงูููุงุนูุฏ
  const allToDisplay = [...todayAppointments, ...upcomingAppointments, ...pastAppointments];
  
  const uniqueMap = new Map();
  allToDisplay.forEach(appointment => {
    const key = `${appointment.doctorId}-${appointment.date}-${appointment.time}`;
    if (!uniqueMap.has(key)) {
      uniqueMap.set(key, appointment);
    }
  });
  
  return sortAppointments(Array.from(uniqueMap.values()));
})();
```

### **โ ุงูุญู 2: ุฅุถุงูุฉ ูุธุงู ุฅุดุนุงุฑุงุช ููุฏูุชูุฑ**

#### **ุงูุชุญุฏูุซ ูู ุญุฌุฒ ุงูููุนุฏ (server.js):**
```javascript
// ูุจู (ุฎุงุทุฆ)
await appointment.save();

// ุฅุฑุณุงู ุฅุดุนุงุฑ ููุทุจูุจ
console.log(`๐ง ุฅุฑุณุงู ุฅุดุนุงุฑ ููุทุจูุจ: ${doctor.email}`);
// ููุง ูููู ุฅุถุงูุฉ ููุฏ ุฅุฑุณุงู ุงูุฅุดุนุงุฑ ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุฃู Push Notification

// ุฅุฑุณุงู ุฅุดุนุงุฑ ูููุณุชุฎุฏู
console.log(`๐ง ุฅุฑุณุงู ุฅุดุนุงุฑ ูููุณุชุฎุฏู: ${user.email}`);
// ููุง ูููู ุฅุถุงูุฉ ููุฏ ุฅุฑุณุงู ุงูุฅุดุนุงุฑ ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุฃู Push Notification

// ุจุนุฏ (ุตุญูุญ)
await appointment.save();

// ุฅุฑุณุงู ุฅุดุนุงุฑ ููุทุจูุจ
console.log(`๐ง ุฅุฑุณุงู ุฅุดุนุงุฑ ููุทุจูุจ: ${doctor.email}`);

// ุฅูุดุงุก ุฅุดุนุงุฑ ููุทุจูุจ
const doctorNotification = new Notification({
  userId: doctorId,
  userType: 'doctor',
  title: 'ููุนุฏ ุฌุฏูุฏ',
  message: `ุชู ุญุฌุฒ ููุนุฏ ุฌุฏูุฏ ูู ${user.first_name} ูู ${date} ุงูุณุงุนุฉ ${time}`,
  type: 'appointment',
  appointmentId: appointment._id,
  read: false
});

await doctorNotification.save();
console.log(`โ ุชู ุฅูุดุงุก ุฅุดุนุงุฑ ููุทุจูุจ - ID: ${doctorNotification._id}`);

// ุฅุฑุณุงู ุฅุดุนุงุฑ ูููุณุชุฎุฏู
console.log(`๐ง ุฅุฑุณุงู ุฅุดุนุงุฑ ูููุณุชุฎุฏู: ${user.email}`);

// ุฅูุดุงุก ุฅุดุนุงุฑ ูููุณุชุฎุฏู
const userNotification = new Notification({
  userId: userId,
  userType: 'user',
  title: 'ุชู ุญุฌุฒ ุงูููุนุฏ',
  message: `ุชู ุญุฌุฒ ููุนุฏู ูุน ุงูุฏูุชูุฑ ${doctor.name} ูู ${date} ุงูุณุงุนุฉ ${time}`,
  type: 'appointment',
  appointmentId: appointment._id,
  read: false
});

await userNotification.save();
console.log(`โ ุชู ุฅูุดุงุก ุฅุดุนุงุฑ ูููุณุชุฎุฏู - ID: ${userNotification._id}`);
```

### **โ ุงูุญู 3: ุชุญุฏูุซ ููุงุท ููุงูุฉ ุงูุฅุดุนุงุฑุงุช**

#### **ุฌูุจ ุงูุฅุดุนุงุฑุงุช:**
```javascript
app.get('/api/notifications', async (req, res) => {
  try {
    const { userId, userType } = req.query;
    console.log(`๐ ุฌูุจ ุงูุฅุดุนุงุฑุงุช - ุงููุณุชุฎุฏู: ${userId}, ุงูููุน: ${userType}`);
    
    if (!userId) {
      return res.status(400).json({ error: 'ูุนุฑู ุงููุณุชุฎุฏู ูุทููุจ' });
    }
    
    const notifications = await Notification.find({ 
      userId: userId,
      userType: userType || 'user'
    }).sort({ createdAt: -1 });
    
    console.log(`โ ุชู ุฌูุจ ${notifications.length} ุฅุดุนุงุฑ`);
    res.json(notifications);
  } catch (err) {
    console.error('โ ุฎุทุฃ ูู ุฌูุจ ุงูุฅุดุนุงุฑุงุช:', err);
    res.status(500).json({ error: 'ุญุฏุซ ุฎุทุฃ ูู ุฌูุจ ุงูุฅุดุนุงุฑุงุช' });
  }
});
```

#### **ุชุญุฏูุซ ุญุงูุฉ ูุฑุงุกุฉ ุงูุฅุดุนุงุฑุงุช:**
```javascript
app.put('/api/notifications/mark-read', async (req, res) => {
  try {
    const { userId, userType } = req.query;
    console.log(`๐ ุชุญุฏูุซ ุญุงูุฉ ูุฑุงุกุฉ ุงูุฅุดุนุงุฑุงุช - ุงููุณุชุฎุฏู: ${userId}, ุงูููุน: ${userType}`);
    
    if (!userId) {
      return res.status(400).json({ error: 'ูุนุฑู ุงููุณุชุฎุฏู ูุทููุจ' });
    }
    
    const result = await Notification.updateMany(
      { 
        userId: userId,
        userType: userType || 'user',
        read: false
      },
      { read: true }
    );
    
    console.log(`โ ุชู ุชุญุฏูุซ ${result.modifiedCount} ุฅุดุนุงุฑ ูู ููุฑูุก`);
    res.json({ 
      message: 'ุชู ุชุญุฏูุซ ุญุงูุฉ ูุฑุงุกุฉ ุงูุฅุดุนุงุฑุงุช ุจูุฌุงุญ',
      updatedCount: result.modifiedCount
    });
  } catch (err) {
    console.error('โ ุฎุทุฃ ูู ุชุญุฏูุซ ุญุงูุฉ ูุฑุงุกุฉ ุงูุฅุดุนุงุฑุงุช:', err);
    res.status(500).json({ error: 'ุญุฏุซ ุฎุทุฃ ูู ุชุญุฏูุซ ุญุงูุฉ ูุฑุงุกุฉ ุงูุฅุดุนุงุฑุงุช' });
  }
});
```

---

## ๐ **ููุงุท ุงูููุงูุฉ ุงููุชุงุญุฉ ุงูุขู:**

### **โ ุงูุฅุดุนุงุฑุงุช:**
```javascript
GET /api/notifications โ (ุฌูุจ ุฅุดุนุงุฑุงุช ุงููุณุชุฎุฏู/ุงูุทุจูุจ)
PUT /api/notifications/mark-read โ (ุชุญุฏูุซ ุญุงูุฉ ูุฑุงุกุฉ ุงูุฅุดุนุงุฑุงุช)
```

### **โ ุงูููุงุนูุฏ:**
```javascript
POST /api/appointments โ (ุญุฌุฒ ููุนุฏ ุฌุฏูุฏ ูุน ุฅุดุนุงุฑุงุช)
GET /api/user-appointments/:userId โ (ุฌูุจ ููุงุนูุฏ ุงููุณุชุฎุฏู)
GET /api/doctor-appointments/:doctorId โ (ุฌูุจ ููุงุนูุฏ ุงูุทุจูุจ)
```

---

## ๐ **ุงูุฎุทูุงุช ุงูุชุงููุฉ:**

### **ุงูุฎุทูุฉ 1: ุงูุชุธุงุฑ ุงูุชุญุฏูุซุงุช**
- โณ **Railway ุณูุนูุฏ ุชุดุบูู ุงูุจุงููุฏ (2-3 ุฏูุงุฆู)**
- โณ **Vercel/Netlify ุณูุนูุฏ ุชุดุบูู ุงููุฑููุช (1-2 ุฏูููุฉ)**

### **ุงูุฎุทูุฉ 2: ุงุฎุชุจุงุฑ ุนุฑุถ ุงูููุงุนูุฏ**
- โ **ุงุฎุชุจุงุฑ ุตูุญุฉ ููุงุนูุฏู ูููุณุชุฎุฏู**
- โ **ุชุญูู ูู ุนุฑุถ ููุงุนูุฏ ุงูููู ููุท**
- โ **ุงุฎุชุจุงุฑ ุชูุนูู "ุนุฑุถ ุงูุณุงุจูุฉ"**

### **ุงูุฎุทูุฉ 3: ุงุฎุชุจุงุฑ ุงูุฅุดุนุงุฑุงุช**
- โ **ุงุฎุชุจุงุฑ ุญุฌุฒ ููุนุฏ ุฌุฏูุฏ**
- โ **ุชุญูู ูู ูุตูู ุงูุฅุดุนุงุฑ ููุฏูุชูุฑ**
- โ **ุชุญูู ูู ูุตูู ุงูุฅุดุนุงุฑ ูููุณุชุฎุฏู**

---

## ๐ฏ **ุงููุชุงุฆุฌ ุงููุชููุนุฉ:**

### **ุจุนุฏ ุชุทุจูู ุงูุญููู:**
```
โ ุตูุญุฉ ููุงุนูุฏู ุชุนุฑุถ ููุงุนูุฏ ุงูููู ููุท
โ ุงูุฅุดุนุงุฑุงุช ุชุตู ููุฏูุชูุฑ ุนูุฏ ุญุฌุฒ ููุนุฏ
โ ุงูุฅุดุนุงุฑุงุช ุชุตู ูููุณุชุฎุฏู ุนูุฏ ุชุฃููุฏ ุงูุญุฌุฒ
โ ูุธุงู ุฅุดุนุงุฑุงุช ูุงูู ูุนูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
โ ุฌููุน ุงููุธุงุฆู ุชุนูู ุจุดูู ุตุญูุญ
```

---

## ๐ง **ุงุฎุชุจุงุฑ ุดุงูู:**

### **ุงุฎุชุจุงุฑ ุนุฑุถ ุงูููุงุนูุฏ:**
1. **ุงูุชุญ ุตูุญุฉ ููุงุนูุฏู**
2. **ุชุญูู ูู ุนุฑุถ ููุงุนูุฏ ุงูููู ููุท**
3. **ุงุฎุชุจุฑ ุชูุนูู "ุนุฑุถ ุงูุณุงุจูุฉ"**
4. **ุชุญูู ูู ุนุฏู ุธููุฑ ุฃุฎุทุงุก**

### **ุงุฎุชุจุงุฑ ุงูุฅุดุนุงุฑุงุช:**
1. **ุงุญุฌุฒ ููุนุฏ ุฌุฏูุฏ**
2. **ุชุญูู ูู ูุตูู ุงูุฅุดุนุงุฑ ููุฏูุชูุฑ**
3. **ุชุญูู ูู ูุตูู ุงูุฅุดุนุงุฑ ูููุณุชุฎุฏู**
4. **ุงุฎุชุจุฑ ุชุญุฏูุซ ุญุงูุฉ ูุฑุงุกุฉ ุงูุฅุดุนุงุฑุงุช**

---

## ๐ **ูุนูููุงุช ุฅุถุงููุฉ:**

### **ุงูุจูุงูุงุช ุงููุชููุนุฉ:**
```
โ ููุงุนูุฏ ุงูููู: ูุตูููุฉ ูู ููุงุนูุฏ ุงูููู ููุท
โ ุฅุดุนุงุฑุงุช ุงูุฏูุชูุฑ: ุฅุดุนุงุฑ ุจููุนุฏ ุฌุฏูุฏ
โ ุฅุดุนุงุฑุงุช ุงููุณุชุฎุฏู: ุชุฃููุฏ ุญุฌุฒ ุงูููุนุฏ
โ ุญุงูุฉ ูุฑุงุกุฉ ุงูุฅุดุนุงุฑุงุช: ุชุญุฏูุซ ุชููุงุฆู
```

### **ุฅุฐุง ูู ุชุนูู ุงููุธุงุฆู ุจุนุฏ:**
1. **ุงูุชุธุฑ 3-5 ุฏูุงุฆู ูุฅุนุงุฏุฉ ุงูุชุดุบูู**
2. **ุชุญูู ูู Railway Logs**
3. **ุงุฎุชุจุฑ ููุงุท ุงูููุงูุฉ ุงูุฌุฏูุฏุฉ**
4. **ุชุญูู ูู Console ููุฑุณุงุฆู ุงูุชุดุฎูุตูุฉ**
5. **ุฃุฎุจุฑูู ุจุงููุชุงุฆุฌ**

---

## ๐ **ุงูุฎูุงุตุฉ:**

### **โ ุฌููุน ุงููุดุงูู ูุญูููุฉ:**
- **ุนุฑุถ ุงูููุงุนูุฏ** โ ุฅุตูุงุญ ุนุฑุถ ููุงุนูุฏ ุงูููู ููุท
- **ุฅุดุนุงุฑุงุช ุงูุฏูุชูุฑ** โ ุฅุถุงูุฉ ูุธุงู ุฅุดุนุงุฑุงุช ูุงูู
- **ูุธุงู ุงูุฅุดุนุงุฑุงุช** โ ุชุญุฏูุซ ููุงุท ุงูููุงูุฉ

### **โณ ูู ุงูุชุธุงุฑ:**
- **Railway** ูุฅุนุงุฏุฉ ุชุดุบูู ุงูุจุงููุฏ
- **Vercel/Netlify** ูุฅุนุงุฏุฉ ุชุดุบูู ุงููุฑููุช
- **ุงุฎุชุจุงุฑ** ุฌููุน ุงููุธุงุฆู

---

## ๐งช **ุงุฎุชุจุงุฑ ุดุงูู:**

### **ุงุฎุชุจุงุฑ ุงููุงุฌูุฉ:**
1. **ุงูุชุญ ุตูุญุฉ ููุงุนูุฏู**
2. **ุชุญูู ูู ุนุฑุถ ููุงุนูุฏ ุงูููู ููุท**
3. **ุงุฎุชุจุฑ ุญุฌุฒ ููุนุฏ ุฌุฏูุฏ**
4. **ุชุญูู ูู ูุตูู ุงูุฅุดุนุงุฑุงุช**

### **ุงุฎุชุจุงุฑ API:**
1. **ุงุฎุชุจุฑ ููุงุท ุงูููุงูุฉ ุงูุฌุฏูุฏุฉ**
2. **ุชุญูู ูู ุฅูุดุงุก ุงูุฅุดุนุงุฑุงุช**
3. **ุชุฃูุฏ ูู ุตุญุฉ ุงูุจูุงูุงุช ุงูููุฑุฌุนุฉ**

---

**๐ฏ ุฌููุน ุงููุดุงูู ูุญูููุฉ! ุงูุชุธุฑ ุงูุชุญุฏูุซุงุช ุซู ุงุฎุชุจุฑ ุงููุธุงุฆู**

**ุณุชุนูู ุงูููุงุนูุฏ ูุงูุฅุดุนุงุฑุงุช ุงูุขู ุจุดูู ุตุญูุญ!** 